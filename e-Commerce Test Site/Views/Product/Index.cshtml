@using System.Globalization; 
@model Product

@{
    ViewData["Title"] = Model.Title;
    var discountDecimal = Model.DiscountPercentage / 100;
    var originalPrice = Model.Price / (1 - discountDecimal);
}

<div class="row">
    <div class="col-sm-4">
        <img class="img-fluid" src=@Model.Images![0] alt="@Model.Title"/>
    </div>
    <div class="col-sm-5">
        <h2>@Model.Title</h2>
        @for (int i = 0; i < Math.Floor(Model.Rating); i++)
        {
            <span class="fas fa-star starcheck"></span>
        }
        @for (int i = 0; i < (5 - Math.Floor(Model.Rating)); i++)
        {
            <span class="fas fa-star"></span>
        }
        <span>@Model.Rating.ToString(new CultureInfo("en-US", false))</span>
        <p class="mt-5 fs-5">@Model.Description</p>
    </div>
    <div class="col-sm-2">
        <div class="border rounded p-5 fw-semibold d-flex flex-column">
            <div class="mt-3 d-flex gap-2 mx-auto">
                <div class="text-decoration-line-through h5">@originalPrice.ToString("c", new CultureInfo("it-IT", false))</div>
                <div class="text-danger h6">-@discountDecimal.ToString("p")</div>
            </div>
            <h3 class="mx-auto">@Model.Price.ToString("c", new CultureInfo("it-IT", false))</h3> <!--maybe make user choose the currency and use a variable, new CultureInfo(currency, false)-->
            <a class="btn btn-warning mt-4 w-100 mx-auto">Buy now</a>
            <div class="mt-2">
                <vc:add-to-cart product-id=@Model.Id stock=@Model.Stock></vc:add-to-cart>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <h3 class="mt-5">From the same category...</h3>
    <div class="d-flex justify-content-evenly mt-4">
        @foreach (Product product in await APIGetter.GetCategoryProductsAsync(Model.Category!))
        {
               <figure>
                    <a href=@("/product/" + product.Id)><img src=@(product.Thumbnail) alt=@(product.Title!.Replace(" ", "")) style="width:200px;height:200px" /></a>
                    <a href=@("/product/" + product.Id) class="text-decoration-none"><figcaption class="text-center mt-3">@product.Title</figcaption></a>
               </figure>
        }
    </div>
</div>